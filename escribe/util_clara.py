symptom_translation_dict = {
    "Abulia": "Abulia",
    "Abusodesustancias": "Substance Abuse",
    "Abusosexual": "Sexual Abuse",
    "Actitudalucinatoria": "Hallucinatory Behavior",
    "Actituddeextraeza": "Attitude of Estrangement",
    "Actitudpueril": "Childish Behavior",
    "Adiccinotras": "Other Addictions",
    "Afectoembotado": "Affective Blunting",
    "AfectoplanoAfectoembotado": "Flat/Blunt Affect",
    "Agitacinpsicomotora": "Psychomotor Agitation",
    "Agresividad": "Aggression",
    "Aislamientoemocional": "Emotional Isolation",
    "Alcohol": "Alcohol",
    "Alogia" : "Alogia",
    "Alteracindelapercepcindepesoofiguracorporal": "Alteration in Body Perception",
    "Alteracionessensoperceptivas": "Sensory/Perceptual Alterations",
    "Alteraciones psicomotoras": "Psychomotor Alterations",
    "Alucinaciones": "Hallucinations",
    "Alucinacionesauditorias": "Auditory Hallucinations",
    "Alucinacionesotras": "Other Hallucinations",
    "Alucinacionesvisual": "Visual Hallucinations",
    "Alucingenos": "Hallucinogens",
    "AngustiaMiedoTemor": "Anguish/Fear/Dread",
    "Anhedonia": "Anhedonia",
    "Animodeprimido": "Depressed Mood",
    "Animoexpansivo": "Elevated Mood",
    "Ansiedad": "Anxiety",
    "Apata": "Apathy",
    "Apetitoaumentode": "Increased Appetite",
    "Apetitodisminucinde": "Decreased Appetite",
    "Atracones": "Binge Eating",
    "Autolesin": "Self-harm",
    "Bajaconcentracin": "Poor Concentration",
    "Bajaenerga": "Low Energy",
    "Cambio de peso": "Change in Weight",
    "Cannabis": "Cannabis",
    "Cigarrillotabaco": "Cigarette/Tobacco",
    "Circunstancialidad": "Circumstantiality",
    "Cocana": "Cocaine",
    "ComportamientocatatnicoCatatonia": "Catatonic Behavior",
    "Compulsiones": "Compulsions",
    "Conductadesorganizada": "Disorganized Behavior",
    "Culpa": "Guilt",
    "Delirios": "Delusions",
    "Desesperanza": "Hopelessness",
    "Desordenformaldelpensamiento": "Thought Disorder",
    "DespersonalizacinDesrealizacin": "Depersonalization/Derealization",
    "Deteriorocognitivo": "Cognitive Decline",
    "DiscapacidadcognitivaEjemplos": "Cognitive Disability",
    "DiscursodesorganizadoDescarrilamiento": "Disorganized Speech",
    "Disforia": "Dysphoria",
    "Dromomana": "Dromomania",
    "Ecolalia": "Echolalia",
    "Efectosadversos": "Adverse Effects",
    "Ensituacindecalle": "Homelessness",
    "Eutimia": "Euthymia",
    "Experienciasdepasividad": "Passivity Experiences",
    "Falsosreconocimientos": "False Recognition",
    "Fatiga": "Fatigue",
    "Fugadeideas": "Flight of Ideas",
    "Grandiosidad": "Grandiosity",
    "Hipersexualidad": "Hypersexuality",
    "Hipertimia": "Hyperthymia",
    "Hipotimia": "Hypothymia",
    "Hostilidad": "Hostility",
    "Ideacinpersecutoria": "Persecutory Ideation",
    "Ideacinsuicida": "Suicidal Ideation",
    "Ideasdemuerte": "Thoughts of Death",
    "Ideassobrevaloradas": "Overvalued Ideas",
    "Impulsividad": "Impulsivity",
    "Incoherencia": "Incoherence",
    "Inhalantes": "Inhalants",
    "Intentosuicida": "Suicide Attempt",
    "Introspeccinpobreinsightpobre": "Poor Insight",
    "Irritabilidad": "Irritability",
    "Juiciocomprometido": "Compromised Judgment",
    "Labilidademocional": "Emotional Lability",
    "Llantofcil": "Easy Crying",
    "Malahigienepersonal": "Poor Personal Hygiene",
    "Maltratofsicopsicolgico": "Physical/Psychological Abuse",
    "Memoriaalterada": "Altered Memory",
    "Minusvala": "Worthlessness",
    "Modulacinafectivaalterada": "Altered Affective Modulation",
    "Mutismo": "Mutism",
    "Negativismo": "Negativism",
    "Nohacecontactovisual": "Lack of Eye Contact",
    "Obsesiones": "Obsessions",
    "Orientacinalterada": "Altered Orientation",
    "Paranoia": "Paranoia",
    "Perseverancia": "Perseveration",
    "PesoIncremento": "Weight Gain",
    "PesoPrdida": "Weight Loss",
    "Pnico": "Panic",
    "Pobreadherencia": "Poor Adherence",
    "Pobrerespuestaapsicofrmacos": "Poor Response to Psychotropic Drugs",
    "Pobrezadepensamiento": "Poverty of Thought",
    "Prospeccindelirante": "Delusional Prospection",
    "Prospeccindesesperanzada": "Hopeless Prospection",
    "Purgasvmitoautoinducido": "Induced Vomiting (Purging)",
    "QuitarselaropaDesnudarse": "Disrobing",
    "Referencial": "Referential Thinking",
    "Religiosidad": "Religiosity",
    "Resonanciaemocionalalterada": "Altered Emotional Resonance",
    "RetraimientosocialAislamiento": "Social Withdrawal/Isolation",
    "Retrasopsicomotor": "Psychomotor Delay",
    "Rumiacin": "Rumination",
    "SÃ­ntomas negativos": "Negative Symptoms",
    "Sntomasafectivos": "Affective Symptoms",
    "Sntomasansiososgenerales": "Anxious Symptoms",
    "Sntomascognitivosgenerales": "Cognitive Symptoms",
    "Sntomasdepresivosgenerales": "Depressive Symptoms",
    "Sntomashipomanacos": "Hypomanic Symptoms",
    "Sntomasmanacosgenerales": "Manic Symptoms",
    "Sntomaspsicticosgenerales": "Psychotic Symptoms",
    "Sntomasresiduales": "Residual Symptoms",
    "SntomassomticosEjemplos": "Somatic Symptoms",
    "Soledad": "Loneliness",
    "Somnolencia": "Somnolence",
    "SueoAlterado": "Altered Sleep",
    "SueoDespertartemprano": "Early Awakening",
    "SueoDisminucindenecesidad": "Decreased Need for Sleep",
    "SueoHipersomnio": "Hypersomnia",
    "SueoInsomnio": "Insomnia",
    "SueoPesadillas": "Nightmares",
    "Tangencialidad": "Tangentiality",
    "TaquilaliaVerborreaPresindelhabla": "Hyperverbosity",
    "TECAR": "TECAR",
    "Usodesustancias": "Substance Use"
}


import re
def remove_non_english_characters(text):
    # Replace all non-English letters (anything not a-z or A-Z) with an empty string
    return re.sub(r'[^a-zA-Z]', '', text)


def get_all_descendant_concepts(my_concept,my_dict):
    descendants=[]
    if not my_concept in my_dict.keys():
        return descendants
    for child in my_dict[my_concept]:
        descendants.append(child)
        if child in my_dict.keys():
            descendants=descendants+my_dict[child]
    return(list(set(descendants)))

def find_ancestors_clara(my_label, my_parent_child_df, my_ancestors=set()):
    # Get the immediate parents of the label
    parents = my_parent_child_df[my_parent_child_df['items'] == my_label]['broad'].tolist()
    
    # For each parent, find ancestors recursively
    for parent in parents:
        if parent not in my_ancestors:  # Avoid cycles and already visited nodes
            my_ancestors.add(parent)
            find_ancestors_clara(parent, my_parent_child_df, my_ancestors)
    return my_ancestors